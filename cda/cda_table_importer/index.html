
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../workplan/">
      
      
        <link rel="next" href="../cda_factory/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.34">
    
    
      
        <title>cda_table_importer - oncoexporter</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.35f28582.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="white">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cdatableimporter" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="oncoexporter" class="md-header__button md-logo" aria-label="oncoexporter" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            oncoexporter
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              cda_table_importer
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="white"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="oncoexporter" class="md-nav__button md-logo" aria-label="oncoexporter" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    oncoexporter
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workplan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workplan
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" checked>
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    cda
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            cda
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    cda_table_importer
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    cda_table_importer
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.oncoexporter.cda.CdaTableImporter" class="md-nav__link">
    <span class="md-ellipsis">
      CdaTableImporter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.oncoexporter.cda.CdaTableImporter.get_ga4gh_phenopackets" class="md-nav__link">
    <span class="md-ellipsis">
      get_ga4gh_phenopackets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.oncoexporter.cda.CdaTableImporter.get_merged_diagnosis_research_subject_df" class="md-nav__link">
    <span class="md-ellipsis">
      get_merged_diagnosis_research_subject_df
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.oncoexporter.cda.CdaTableImporter.get_merged_subject_research_subject_df" class="md-nav__link">
    <span class="md-ellipsis">
      get_merged_subject_research_subject_df
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.oncoexporter.cda.CdaTableImporter.get_specimen_df" class="md-nav__link">
    <span class="md-ellipsis">
      get_specimen_df
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cda_factory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cda_factory
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cda_individual_factory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cda_individual_factory
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cda_disease_factory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cda_disease_factory
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cda_biosample_factory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cda_biosample_factory
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cda_mutation_factory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cda_mutation_factory
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    model
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            model
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model/op_individual/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    op_individual
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    explanations
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            explanations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/cda_disease/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cda_disease
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/cda_mutation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cda_mutation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="cdatableimporter">CdaTableImporter</h1>


<div class="doc doc-object doc-class">



<a id="src.oncoexporter.cda.CdaTableImporter"></a>
    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="src.oncoexporter.cda.cda_importer.CdaImporter">CdaImporter</span>[<span title="cdapython.fetch_rows">fetch_rows</span>]</code></p>


        <p>This class is the entry point for transforming CDA data into GA4GH Phenopackets. Client code only needs
to initialize it with a CDA query, and it can return phenopackets with the :func:<code>get_ga4gh_phenopackets</code>.
It also returns individual tables for that can be used for testing or visualizing data.</p>
<p>The CDA query determines the cohort that will be retrieved from CDA. This class then retrieves data
for this cohort in form of pandas DataFrames and extracts data for phenopacket construction using the data
in the tables</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>disease_factory</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.oncoexporter.cda.cda_disease_factory.CdaDiseaseFactory" href="../cda_disease_factory/#src.oncoexporter.cda.CdaDiseaseFactory">CdaDiseaseFactory</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the component for mapping CDA table into Disease element of the Phenopacket Schema.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>cache_dir</code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a <code>str</code> with path to the folder to store the cache files</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>use_cache</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if True, cache/retrieve from cache</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>page_size</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of pages to retrieve at once. Defaults to <code>10000</code>  New CDA:  https://cda.readthedocs.io/en/latest/documentation/cdapython/code_update/#returning-a-matrix-of-results old: all of the functions previously used with, or chained onto Q()...run() have been replaced with the single function fetch_rows() new: `fetch_rows(table=, )  https://cda.readthedocs.io/en/latest/documentation/cdapython/code_update/#parameters old: page_size, limit, and count parameters have been removed new: column_values always returns all unique values and their counts by default, however there are several new parameters  old: system=<data source> new: data_source=<data source> can now take a list, as in data_source=["GDC", "PDC"]  new: sort_by=<column:asc/desc> sort results by any column  new: force=<True/False> For columns with an extremely large number of unique values, such as filename, the query will fail with a large data warning. You can override the warning with Force=True  tables: ['diagnosis', 'file', 'researchsubject', 'somatic_mutation', 'specimen', 'subject', 'treatment']</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/oncoexporter/cda/cda_table_importer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="k">class</span> <span class="nc">CdaTableImporter</span><span class="p">(</span><span class="n">CdaImporter</span><span class="p">[</span><span class="n">fetch_rows</span><span class="p">]):</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This class is the entry point for transforming CDA data into GA4GH Phenopackets. Client code only needs</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    to initialize it with a CDA query, and it can return phenopackets with the :func:`get_ga4gh_phenopackets`.</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    It also returns individual tables for that can be used for testing or visualizing data.</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    The CDA query determines the cohort that will be retrieved from CDA. This class then retrieves data</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    for this cohort in form of pandas DataFrames and extracts data for phenopacket construction using the data</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    in the tables</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    :param disease_factory: the component for mapping CDA table into Disease element of the Phenopacket Schema.</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    :param cache_dir: a `str` with path to the folder to store the cache files</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    :param use_cache: if True, cache/retrieve from cache</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    :param page_size: Number of pages to retrieve at once. Defaults to `10000`</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    New CDA: </span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    https://cda.readthedocs.io/en/latest/documentation/cdapython/code_update/#returning-a-matrix-of-results</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    old: all of the functions previously used with, or chained onto Q()...run() have been replaced with the single function fetch_rows()</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    new: `fetch_rows(table=, )</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">    https://cda.readthedocs.io/en/latest/documentation/cdapython/code_update/#parameters</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    old: page_size, limit, and count parameters have been removed</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    new: column_values always returns all unique values and their counts by default, however there are several new parameters</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    old: system=&lt;data source&gt;</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    new: data_source=&lt;data source&gt; can now take a list, as in data_source=[&quot;GDC&quot;, &quot;PDC&quot;]</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    new: sort_by=&lt;column:asc/desc&gt; sort results by any column</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    new: force=&lt;True/False&gt; For columns with an extremely large number of unique values, such as filename, the query will fail with a large data warning. You can override the warning with Force=True</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    tables: [&#39;diagnosis&#39;, &#39;file&#39;, &#39;researchsubject&#39;, &#39;somatic_mutation&#39;, &#39;specimen&#39;, &#39;subject&#39;, &#39;treatment&#39;]</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>                 <span class="n">disease_factory</span><span class="p">:</span> <span class="n">CdaDiseaseFactory</span><span class="p">,</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>                 <span class="n">use_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>                 <span class="n">cache_dir</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>                 <span class="c1">#page_size: int = 10000,</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>                 <span class="n">gdc_timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">,</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>                 <span class="p">):</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_use_cache</span> <span class="o">=</span> <span class="n">use_cache</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="c1">#self._page_size = page_size # not in new CDA </span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_individual_factory</span> <span class="o">=</span> <span class="n">CdaIndividualFactory</span><span class="p">()</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_disease_factory</span> <span class="o">=</span> <span class="n">disease_factory</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_specimen_factory</span> <span class="o">=</span> <span class="n">CdaBiosampleFactory</span><span class="p">()</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mutation_factory</span> <span class="o">=</span> <span class="n">CdaMutationFactory</span><span class="p">()</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_gdc_mutation_service</span> <span class="o">=</span> <span class="n">GdcMutationService</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">gdc_timeout</span><span class="p">)</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="k">if</span> <span class="n">cache_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_cache_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;.oncoexporter_cache&#39;</span><span class="p">)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache_dir</span><span class="p">):</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">W_OK</span><span class="p">):</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;`cache_dir` must be a writable directory: </span><span class="si">{</span><span class="n">cache_dir</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="k">def</span> <span class="nf">_get_cda_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback_fxn</span><span class="p">,</span> <span class="n">cache_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="n">fpath_cache</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache_dir</span><span class="p">,</span> <span class="n">cache_name</span><span class="p">)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_cache</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fpath_cache</span><span class="p">):</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Retrieving dataframe </span><span class="si">{</span><span class="n">fpath_cache</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fpath_cache</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cachehandle</span><span class="p">:</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;loading cached dataframe from </span><span class="si">{</span><span class="n">fpath_cache</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>                <span class="n">individual_df</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">cachehandle</span><span class="p">)</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">calling CDA function&quot;</span><span class="p">)</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="n">individual_df</span> <span class="o">=</span> <span class="n">callback_fxn</span><span class="p">()</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_cache</span><span class="p">:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating cached dataframe as </span><span class="si">{</span><span class="n">fpath_cache</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fpath_cache</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>                    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">individual_df</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="k">return</span> <span class="n">individual_df</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="c1"># not clear why this is _ but others are not...</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="k">def</span> <span class="nf">_get_subject_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">cohort_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the subject dataframe from CDA</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">        This method uses the Query that was passed to the constructor to retrieve data from the CDA subject table</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">        :raises: raises an exception if the query object was not properly initialized</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        :returns: pandas DataFrame that corresponds to the CDA subject table.</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">        :rtype: pd.DataFrame</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Getting subject df...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="c1">#callable = lambda: q.subject.run(page_size=self._page_size).get_all().to_dataframe()</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="nb">callable</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">fetch_rows</span><span class="p">(</span> <span class="n">table</span><span class="o">=</span><span class="s1">&#39;subject&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">q</span> <span class="p">)</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="n">subject_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cda_df</span><span class="p">(</span><span class="nb">callable</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cohort_name</span><span class="si">}</span><span class="s2">_individual_df.pkl&quot;</span><span class="p">)</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;obtained subject_df&quot;</span><span class="p">)</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="k">return</span> <span class="n">subject_df</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="k">def</span> <span class="nf">get_merged_diagnosis_research_subject_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">cohort_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">        Retrieve a merged dataframe from CDA corresponding to the diagnosis and research subject tables</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">        diagnosis table columns: diagnosis_id, age_at_diagnosis, grade, method_of_diagnosis, morphology, primary_diagnosis, stage</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">        researchsubject table columns: researchsubject_id, member_of_research_project, primary_diagnosis_condition, primary_diagnosis_site</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">        Need to combine in order to get primary_diagnosis_condition and primary_diagnosis_site with diagnosis table</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        Original:</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        diagnosis_callable = lambda: q.diagnosis.run(page_size=self._page_size).get_all().to_dataframe()</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        diagnosis_df = self._get_cda_df(diagnosis_callable, f&quot;{cohort_name}_diagnosis_df.pkl&quot;)</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">        print(&quot;obtained diagnosis_df&quot;)</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        rsub_callable = lambda: q.researchsubject.run(page_size=self._page_size).get_all().to_dataframe()</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        research_subject_df = self._get_cda_df(rsub_callable, f&quot;{cohort_name}_research_subject_df.pkl&quot;)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        print(&quot;obtained research_subject_df&quot;)</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        merged_df = pd.merge(diagnosis_df, research_subject_df, left_on=&#39;researchsubject_id&#39;, right_on=&#39;researchsubject_id&#39;,</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">                             suffixes=[&quot;_di&quot;, &quot;_rs&quot;])</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">        return merged_df</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Getting merged diagnosis and researchsubject df...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="n">diagnosis_callable</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">fetch_rows</span><span class="p">(</span> <span class="n">table</span><span class="o">=</span><span class="s1">&#39;diagnosis&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">q</span> <span class="p">,</span> <span class="n">add_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;subject_id&#39;</span><span class="p">])</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="n">diagnosis_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cda_df</span><span class="p">(</span><span class="n">diagnosis_callable</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cohort_name</span><span class="si">}</span><span class="s2">_diagnosis_df.pkl&quot;</span><span class="p">)</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;obtained diagnosis_df&quot;</span><span class="p">)</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="c1">#diagnosis_df.to_csv(&#39;diagnosis_df.txt&#39;, sep=&#39;\t&#39;)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="c1"># tried link_to_table=&#39;diagnosis&#39; but it doesn&#39;t add any columns</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="n">rsub_callable</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">fetch_rows</span><span class="p">(</span> <span class="n">table</span><span class="o">=</span><span class="s1">&#39;researchsubject&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">q</span> <span class="p">,</span> <span class="n">add_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;subject_id&#39;</span><span class="p">])</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="n">rsub_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cda_df</span><span class="p">(</span><span class="n">rsub_callable</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cohort_name</span><span class="si">}</span><span class="s2">_researchsubject_df.pkl&quot;</span><span class="p">)</span> <span class="c1"># call is repeated below in get_merged_subject_research_subject_df</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;obtained researchsubject_df&quot;</span><span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="c1">#rsub_df.to_csv(&#39;rsub_diagnosis_df.txt&#39;, sep=&#39;\t&#39;)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="c1"># merge tables</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="n">diag_rsub_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">diagnosis_df</span><span class="p">,</span> <span class="n">rsub_df</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;subject_id&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;subject_id&#39;</span><span class="p">)</span> <span class="c1">#, suffixes=[&quot;_di&quot;, &quot;_rs&quot;])</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;obtained merged diagnosis researchsubject df&quot;</span><span class="p">)</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="c1">#diag_rsub_df.to_csv(&#39;diagnosis_rsub.txt&#39;, sep=&#39;\t&#39;)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="k">return</span> <span class="n">diag_rsub_df</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>    <span class="k">def</span> <span class="nf">get_merged_subject_research_subject_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">cohort_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">        Retrieve a merged dataframe from CDA corresponding to the subject and research subject tables</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">        Need both subject_id and researchsubject_id to include variants in phenopacket </span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">        subject table columns: subject_id, cause_of_death, days_to_birth, days_to_death, ethnicity, race</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">                               sex, species, vital_status</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">        researchsubject table columns: researchsubject_id, member_of_research_project, primary_diagnosis_condition, </span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">                                        primary_diagnosis_site</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">        M. Sierk 4-11-24: </span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">            This is how Henry Schaeffer from CBIIT recommended getting the data source:</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">            I consolidate the data_source_id columns (as opposed to just deleting it which works also) or else </span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">            the merge expands each subject into many more rows. For example, for subject provenance I used:</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">            sub = fetch_rows(table=&#39;subject&#39;, provenance=True)</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">            sub[&#39;subject_data_source_id_concat&#39;] = sub.groupby([&#39;subject_id&#39;,&#39;subject_data_source&#39;])[&#39;subject_data_source_id&#39;].transform(lambda x: &#39;,&#39;.join(x))</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">            sub = sub.drop(columns=[&#39;subject_data_source_id&#39;], axis=1)</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">            sub = sub.drop_duplicates()</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Getting merged subject and researchsubject df...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="c1">#subject_callable = lambda: q.subject.run(page_size=self._page_size).get_all().to_dataframe()</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>        <span class="n">subject_callable</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">fetch_rows</span><span class="p">(</span> <span class="n">table</span><span class="o">=</span><span class="s1">&#39;subject&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">q</span> <span class="p">)</span> <span class="c1"># link_to_table=&#39;researchsubject&#39; doesn&#39;t add anything</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="n">subject_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cda_df</span><span class="p">(</span><span class="n">subject_callable</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cohort_name</span><span class="si">}</span><span class="s2">_subject_df.pkl&quot;</span><span class="p">)</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="n">rsub_callable</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">fetch_rows</span><span class="p">(</span> <span class="n">table</span><span class="o">=</span><span class="s1">&#39;researchsubject&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">q</span> <span class="p">,</span> <span class="n">add_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;subject_id&#39;</span><span class="p">])</span> <span class="c1"># repeat from above</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="n">rsub_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cda_df</span><span class="p">(</span><span class="n">rsub_callable</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cohort_name</span><span class="si">}</span><span class="s2">_researchsubject_df.pkl&quot;</span><span class="p">)</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="c1"># merge tables</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="n">subject_rsub_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">subject_df</span><span class="p">,</span> <span class="n">rsub_df</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;subject_id&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;subject_id&#39;</span><span class="p">)</span> <span class="c1">#, suffixes=[&quot;_di&quot;, &quot;_rs&quot;])</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;obtained merged subject and researchsubject df&quot;</span><span class="p">)</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="c1">#subject_rsub_df.to_csv(&#39;subject_rsub_df.txt&#39;, sep=&#39;\t&#39;)</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="c1">#rsub_callable = lambda: q.researchsubject.run(page_size=self._page_size).get_all().to_dataframe()</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="c1">#rsub_callable = lambda: fetch_rows( table=&#39;researchsubject&#39;, **q , link_to_table=&#39;subject&#39; )</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="c1">#research_subject_df = self._get_cda_df(rsub_callable, f&quot;{cohort_name}_research_subject_df.pkl&quot;)</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="c1">#print(&quot;obtained research_subject_df&quot;)</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="c1">#merged_df = pd.merge(subject_df, research_subject_df, left_on=&#39;subject_id&#39;, right_on=&#39;subject_id&#39;,</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>                                <span class="c1">#suffixes=[&quot;_subj&quot;, &quot;_rs&quot;])</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="c1">#research_subject_df.to_csv(&#39;researchsubject_df.txt&#39;, sep=&#39;\t&#39;)</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="k">return</span> <span class="n">subject_rsub_df</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>    <span class="k">def</span> <span class="nf">get_specimen_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">cohort_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the subject dataframe from CDA</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">        This method uses the Query that was passed to the constructor to retrieve data from the CDA subject table</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">        :raises: raises an exception if the query object was not properly initialized</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">        :returns: pandas DataFrame that corresponds to the CDA subject table.</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">        :rtype: pd.DataFrame</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Getting specimen df...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="c1">#specimen_callable = lambda: q.specimen.run(page_size=self._page_size).get_all().to_dataframe()</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="n">specimen_callable</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">fetch_rows</span><span class="p">(</span> <span class="n">table</span><span class="o">=</span><span class="s1">&#39;specimen&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">q</span><span class="p">,</span> <span class="n">add_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;subject_id&#39;</span><span class="p">]</span> <span class="p">)</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>        <span class="n">specimen_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cda_df</span><span class="p">(</span><span class="n">specimen_callable</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cohort_name</span><span class="si">}</span><span class="s2">_specimen_df.pkl&quot;</span><span class="p">)</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="c1">#specimen_df.to_csv(&#39;specimen_df.txt&#39;, sep=&#39;\t&#39;)</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="k">return</span> <span class="n">specimen_df</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>    <span class="k">def</span> <span class="nf">get_treatment_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">cohort_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Getting treatment df...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="c1">#treatment_callable = lambda: q.treatment.run(page_size=self._page_size).get_all().to_dataframe()</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="n">treatment_callable</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">fetch_rows</span><span class="p">(</span> <span class="n">table</span><span class="o">=</span><span class="s1">&#39;treatment&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">q</span><span class="p">,</span> <span class="n">add_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;subject_id&#39;</span><span class="p">]</span> <span class="p">)</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="n">treatment_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cda_df</span><span class="p">(</span><span class="n">treatment_callable</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cohort_name</span><span class="si">}</span><span class="s2">_treatment_df.pkl&quot;</span><span class="p">)</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="c1">#treatment_df.to_csv(&#39;treatment_df.txt&#39;, sep=&#39;\t&#39;)</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="k">return</span> <span class="n">treatment_df</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>    <span class="k">def</span> <span class="nf">get_ga4gh_phenopackets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">PPkt</span><span class="o">.</span><span class="n">Phenopacket</span><span class="p">]:</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a list of GA4GH phenopackets corresponding to the individuals returned by the query passed to the constructor.</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">        :returns: A list of GA4GH phenopackets corresponding to the individuals selected by the query passed to the constructor.</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">        :rtype: typing.List[PPkt.Phenopacket]</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">        New version of CDA: need to change Q to fetch_rows()</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="c1"># no longer using Q objects</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="c1"># if not isinstance(source, Q):</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>        <span class="c1">#    raise ValueError(f&quot;query_obj argument must be Q.Q object, but instead was {type(source)}&quot;)</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="k">if</span> <span class="s1">&#39;cohort_name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>            <span class="n">cohort_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cohort_name&#39;</span><span class="p">]</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>            <span class="c1"># Format it as a string, for example: &#39;YYYY-MM-DD HH:MM:SS&#39;</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>            <span class="n">ts</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">-%H-%M-%S&quot;</span><span class="p">)</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>            <span class="n">cohort_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;cohort-</span><span class="si">{</span><span class="n">ts</span><span class="si">}</span><span class="s1">&#39;</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="c1"># Dictionary of phenopackets, keys are the phenopacket ids.</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="n">ppackt_d</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="c1"># First obtain the pandas DataFrames from the CDA tables with rows that correspond to the Query</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="n">subject_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_subject_df</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">cohort_name</span><span class="p">)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>        <span class="n">diag_rsub_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_merged_diagnosis_research_subject_df</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">cohort_name</span><span class="p">)</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="n">specimen_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_specimen_df</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">cohort_name</span><span class="p">)</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="n">treatment_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_treatment_df</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">cohort_name</span><span class="p">)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="n">subj_rsub_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_merged_subject_research_subject_df</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">cohort_name</span><span class="p">)</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="c1"># Now use the CdaFactory classes to transform the information from the DataFrames into</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="c1"># components of the GA4GH Phenopacket Schema</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="c1"># Add these components one at a time to Phenopacket objects.</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="c1"># treatment_factory = TODO</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Converting to Phenopackets...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>        <span class="c1"># Retrieve GA4GH Individual messages</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">subject_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">(),</span><span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">subject_df</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span> <span class="s2">&quot;individual dataframe&quot;</span><span class="p">):</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>                <span class="n">individual_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_individual_factory</span><span class="o">.</span><span class="n">to_ga4gh</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>                <span class="c1"># TODO: decide how to handle depending on your paranoia</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>                <span class="c1">#</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>                <span class="k">pass</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>            <span class="n">individual_id</span> <span class="o">=</span> <span class="n">individual_message</span><span class="o">.</span><span class="n">id</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>            <span class="n">ppackt</span> <span class="o">=</span> <span class="n">PPkt</span><span class="o">.</span><span class="n">Phenopacket</span><span class="p">()</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>            <span class="n">ppackt</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cohort_name</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1">&#39;</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>            <span class="n">ppackt</span><span class="o">.</span><span class="n">subject</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">individual_message</span><span class="p">)</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>            <span class="n">ppackt_d</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">ppackt</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>        <span class="c1"># Retrieve GA4GH Disease messages</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">diag_rsub_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">(),</span> <span class="n">total</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">diag_rsub_df</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;merged diagnosis and researchsubject dataframe&quot;</span><span class="p">):</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>            <span class="n">disease_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_disease_factory</span><span class="o">.</span><span class="n">to_ga4gh</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>            <span class="c1">#print(row)</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>            <span class="n">pp</span> <span class="o">=</span> <span class="n">ppackt_d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">])</span> 
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>            <span class="c1"># Do not add the disease if it is already in the phenopacket.</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">disease</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">disease_message</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">disease</span> <span class="ow">in</span> <span class="n">pp</span><span class="o">.</span><span class="n">diseases</span><span class="p">):</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>                <span class="n">pp</span><span class="o">.</span><span class="n">diseases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disease_message</span><span class="p">)</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>        <span class="c1"># Retrieve GA4GH Biospecimen messages</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">specimen_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">(),</span><span class="n">total</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">specimen_df</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;specimen/biosample dataframe&quot;</span><span class="p">):</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>            <span class="n">biosample_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_specimen_factory</span><span class="o">.</span><span class="n">to_ga4gh</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>            <span class="n">individual_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">]</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>            <span class="k">if</span> <span class="n">individual_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ppackt_d</span><span class="p">:</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attempt to enter unknown individual ID from biosample factory: </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>            <span class="c1"># convert CDA days_to_collection to PPKt time_of_collection</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>            <span class="c1">#         days_to_collection: number of days from index date to sample collection date</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>            <span class="c1">#         time_of_collection: Age of subject at time sample was collected </span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;days_to_collection&#39;</span><span class="p">]):</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>                <span class="n">days_to_coll_iso</span> <span class="o">=</span> <span class="n">CdaFactory</span><span class="o">.</span><span class="n">days_to_iso</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;days_to_collection&quot;</span><span class="p">]))</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>            <span class="c1"># this should work if both are pd.Timedelta:</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>            <span class="c1"># TODO: fix the code below!</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>            <span class="c1"># time_of_collection = ppackt_d[individual_id][&quot;iso8601duration&quot;] + days_to_coll_iso # should it be &#39;Age&#39; or &#39;iso8601duration&#39;?</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>            <span class="c1"># biosample_message[&quot;time_of_collection&quot;] = time_of_collection</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>            <span class="n">ppackt_d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span><span class="o">.</span><span class="n">biosamples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">biosample_message</span><span class="p">)</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="c1"># Get variant data for each ResearchSubject in Subject</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>        <span class="c1"># takes 45 minutes due to API calls to gdc</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">subj_rsub_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">(),</span> <span class="n">total</span><span class="o">=</span><span class="n">subj_rsub_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;subject researchsubject dataframe&quot;</span><span class="p">):</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>            <span class="n">individual_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">]</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>            <span class="c1"># removing this loop for new CDA API.  Should work the same to go through df by row (MS 4-10-24)</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>            <span class="c1">#  Note: as of 4-10-24, no way to access system/data source from result of fetch_rows (can specify in fetch_rows)</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>            <span class="c1">#for rsub_subj in row[&quot;subject_identifier&quot;]:</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>            <span class="c1">#    if rsub_subj[&quot;system&quot;] == &quot;GDC&quot;:</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>            <span class="c1"># have to strip off the leading name before first period</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>            <span class="c1"># e.g. TCGA.TCGA-05-4250 -&gt; TCGA-05-4250</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>            <span class="n">subj_id</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;^[^.]+\.&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">])</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>            <span class="c1">#print(row[&quot;subject_id&quot;], subj_id)</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>            <span class="n">variant_interpretations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gdc_mutation_service</span><span class="o">.</span><span class="n">fetch_variants</span><span class="p">(</span><span class="n">subj_id</span><span class="p">)</span> <span class="c1"># was rsub_subj[&#39;value&#39;]</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>            <span class="n">vital_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gdc_mutation_service</span><span class="o">.</span><span class="n">fetch_vital_status</span><span class="p">(</span><span class="n">subj_id</span><span class="p">)</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">variant_interpretations</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>                <span class="c1">#print(&quot;No variants found&quot;)</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>                <span class="k">continue</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>            <span class="n">ppackt_d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span><span class="o">.</span><span class="n">subject</span><span class="o">.</span><span class="n">vital_status</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">vital_status</span><span class="p">)</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>            <span class="c1">#else:</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>                <span class="c1">#print(&quot;length variant_interpretations: {}&quot;.format(len(variant_interpretations)))</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>            <span class="c1"># TODO: improve/enhance diagnosis term annotations</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>            <span class="n">diagnosis</span> <span class="o">=</span> <span class="n">PPkt</span><span class="o">.</span><span class="n">Diagnosis</span><span class="p">()</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>            <span class="n">diagnosis</span><span class="o">.</span><span class="n">disease</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s2">&quot;NCIT:C3262&quot;</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>            <span class="n">diagnosis</span><span class="o">.</span><span class="n">disease</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Neoplasm&quot;</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>            <span class="k">for</span> <span class="n">variant</span> <span class="ow">in</span> <span class="n">variant_interpretations</span><span class="p">:</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>                <span class="n">genomic_interpretation</span> <span class="o">=</span> <span class="n">PPkt</span><span class="o">.</span><span class="n">GenomicInterpretation</span><span class="p">()</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>                <span class="n">genomic_interpretation</span><span class="o">.</span><span class="n">subject_or_biosample_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">]</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>                <span class="n">genomic_interpretation</span><span class="o">.</span><span class="n">interpretation_status</span> <span class="o">=</span> <span class="n">PPkt</span><span class="o">.</span><span class="n">GenomicInterpretation</span><span class="o">.</span><span class="n">InterpretationStatus</span><span class="o">.</span><span class="n">UNKNOWN_STATUS</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>                <span class="n">genomic_interpretation</span><span class="o">.</span><span class="n">variant_interpretation</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">variant</span><span class="p">)</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>                <span class="n">diagnosis</span><span class="o">.</span><span class="n">genomic_interpretations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">genomic_interpretation</span><span class="p">)</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>            <span class="n">interpretation</span> <span class="o">=</span> <span class="n">PPkt</span><span class="o">.</span><span class="n">Interpretation</span><span class="p">()</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>            <span class="n">interpretation</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;researchsubject_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>            <span class="n">interpretation</span><span class="o">.</span><span class="n">progress_status</span> <span class="o">=</span> <span class="n">PPkt</span><span class="o">.</span><span class="n">Interpretation</span><span class="o">.</span><span class="n">ProgressStatus</span><span class="o">.</span><span class="n">IN_PROGRESS</span> 
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>            <span class="n">interpretation</span><span class="o">.</span><span class="n">diagnosis</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">diagnosis</span><span class="p">)</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>            <span class="n">ppackt_d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span><span class="o">.</span><span class="n">interpretations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interpretation</span><span class="p">)</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>        <span class="c1"># TODO Treatment</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="c1"># make_cda_medicalaction</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">treatment_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">(),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">treatment_df</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Treatment DF&quot;</span><span class="p">):</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>            <span class="n">individual_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">]</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>            <span class="n">medical_action_message</span> <span class="o">=</span> <span class="n">make_cda_medicalaction</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>            <span class="k">if</span> <span class="n">individual_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ppackt_d</span><span class="p">:</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attempt to enter unknown individual ID from treatment factory: </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>            <span class="n">ppackt_d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span><span class="o">.</span><span class="n">medical_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">medical_action_message</span><span class="p">)</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>        <span class="c1"># When we get here, we have constructed GA4GH Phenopackets with Individual, Disease, Biospecimen, MedicalAction, and GenomicInterpretations</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">ppackt_d</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="src.oncoexporter.cda.CdaTableImporter.get_ga4gh_phenopackets" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_ga4gh_phenopackets</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get a list of GA4GH phenopackets corresponding to the individuals returned by the query passed to the constructor.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>typing.List[PPkt.Phenopacket]  New version of CDA: need to change Q to fetch_rows()</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of GA4GH phenopackets corresponding to the individuals selected by the query passed to the constructor.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/oncoexporter/cda/cda_table_importer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="k">def</span> <span class="nf">get_ga4gh_phenopackets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">PPkt</span><span class="o">.</span><span class="n">Phenopacket</span><span class="p">]:</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a list of GA4GH phenopackets corresponding to the individuals returned by the query passed to the constructor.</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">    :returns: A list of GA4GH phenopackets corresponding to the individuals selected by the query passed to the constructor.</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">    :rtype: typing.List[PPkt.Phenopacket]</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">    New version of CDA: need to change Q to fetch_rows()</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>    <span class="c1"># no longer using Q objects</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="c1"># if not isinstance(source, Q):</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>    <span class="c1">#    raise ValueError(f&quot;query_obj argument must be Q.Q object, but instead was {type(source)}&quot;)</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="k">if</span> <span class="s1">&#39;cohort_name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="n">cohort_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cohort_name&#39;</span><span class="p">]</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="c1"># Format it as a string, for example: &#39;YYYY-MM-DD HH:MM:SS&#39;</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="n">ts</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">-%H-%M-%S&quot;</span><span class="p">)</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="n">cohort_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;cohort-</span><span class="si">{</span><span class="n">ts</span><span class="si">}</span><span class="s1">&#39;</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>    <span class="c1"># Dictionary of phenopackets, keys are the phenopacket ids.</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>    <span class="n">ppackt_d</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>    <span class="c1"># First obtain the pandas DataFrames from the CDA tables with rows that correspond to the Query</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>    <span class="n">subject_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_subject_df</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">cohort_name</span><span class="p">)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>    <span class="n">diag_rsub_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_merged_diagnosis_research_subject_df</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">cohort_name</span><span class="p">)</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>    <span class="n">specimen_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_specimen_df</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">cohort_name</span><span class="p">)</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>    <span class="n">treatment_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_treatment_df</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">cohort_name</span><span class="p">)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>    <span class="n">subj_rsub_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_merged_subject_research_subject_df</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">cohort_name</span><span class="p">)</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>    <span class="c1"># Now use the CdaFactory classes to transform the information from the DataFrames into</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>    <span class="c1"># components of the GA4GH Phenopacket Schema</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>    <span class="c1"># Add these components one at a time to Phenopacket objects.</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>    <span class="c1"># treatment_factory = TODO</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Converting to Phenopackets...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>    <span class="c1"># Retrieve GA4GH Individual messages</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">subject_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">(),</span><span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">subject_df</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span> <span class="s2">&quot;individual dataframe&quot;</span><span class="p">):</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>            <span class="n">individual_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_individual_factory</span><span class="o">.</span><span class="n">to_ga4gh</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>            <span class="c1"># TODO: decide how to handle depending on your paranoia</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>            <span class="c1">#</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>            <span class="k">pass</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>        <span class="n">individual_id</span> <span class="o">=</span> <span class="n">individual_message</span><span class="o">.</span><span class="n">id</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="n">ppackt</span> <span class="o">=</span> <span class="n">PPkt</span><span class="o">.</span><span class="n">Phenopacket</span><span class="p">()</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>        <span class="n">ppackt</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cohort_name</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s1">&#39;</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>        <span class="n">ppackt</span><span class="o">.</span><span class="n">subject</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">individual_message</span><span class="p">)</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>        <span class="n">ppackt_d</span><span class="p">[</span><span class="n">individual_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">ppackt</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>    <span class="c1"># Retrieve GA4GH Disease messages</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">diag_rsub_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">(),</span> <span class="n">total</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">diag_rsub_df</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;merged diagnosis and researchsubject dataframe&quot;</span><span class="p">):</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="n">disease_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_disease_factory</span><span class="o">.</span><span class="n">to_ga4gh</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>        <span class="c1">#print(row)</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>        <span class="n">pp</span> <span class="o">=</span> <span class="n">ppackt_d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">])</span> 
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="c1"># Do not add the disease if it is already in the phenopacket.</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">disease</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">disease_message</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">disease</span> <span class="ow">in</span> <span class="n">pp</span><span class="o">.</span><span class="n">diseases</span><span class="p">):</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>            <span class="n">pp</span><span class="o">.</span><span class="n">diseases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disease_message</span><span class="p">)</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>    <span class="c1"># Retrieve GA4GH Biospecimen messages</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">specimen_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">(),</span><span class="n">total</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">specimen_df</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;specimen/biosample dataframe&quot;</span><span class="p">):</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>        <span class="n">biosample_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_specimen_factory</span><span class="o">.</span><span class="n">to_ga4gh</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>        <span class="n">individual_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">]</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>        <span class="k">if</span> <span class="n">individual_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ppackt_d</span><span class="p">:</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attempt to enter unknown individual ID from biosample factory: </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>        <span class="c1"># convert CDA days_to_collection to PPKt time_of_collection</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>        <span class="c1">#         days_to_collection: number of days from index date to sample collection date</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>        <span class="c1">#         time_of_collection: Age of subject at time sample was collected </span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;days_to_collection&#39;</span><span class="p">]):</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>            <span class="n">days_to_coll_iso</span> <span class="o">=</span> <span class="n">CdaFactory</span><span class="o">.</span><span class="n">days_to_iso</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;days_to_collection&quot;</span><span class="p">]))</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>        <span class="c1"># this should work if both are pd.Timedelta:</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>        <span class="c1"># TODO: fix the code below!</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="c1"># time_of_collection = ppackt_d[individual_id][&quot;iso8601duration&quot;] + days_to_coll_iso # should it be &#39;Age&#39; or &#39;iso8601duration&#39;?</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>        <span class="c1"># biosample_message[&quot;time_of_collection&quot;] = time_of_collection</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="n">ppackt_d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span><span class="o">.</span><span class="n">biosamples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">biosample_message</span><span class="p">)</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>    <span class="c1"># Get variant data for each ResearchSubject in Subject</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>    <span class="c1"># takes 45 minutes due to API calls to gdc</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">subj_rsub_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">(),</span> <span class="n">total</span><span class="o">=</span><span class="n">subj_rsub_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;subject researchsubject dataframe&quot;</span><span class="p">):</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>        <span class="n">individual_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">]</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>        <span class="c1"># removing this loop for new CDA API.  Should work the same to go through df by row (MS 4-10-24)</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>        <span class="c1">#  Note: as of 4-10-24, no way to access system/data source from result of fetch_rows (can specify in fetch_rows)</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>        <span class="c1">#for rsub_subj in row[&quot;subject_identifier&quot;]:</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>        <span class="c1">#    if rsub_subj[&quot;system&quot;] == &quot;GDC&quot;:</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>        <span class="c1"># have to strip off the leading name before first period</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>        <span class="c1"># e.g. TCGA.TCGA-05-4250 -&gt; TCGA-05-4250</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>        <span class="n">subj_id</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;^[^.]+\.&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">])</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>        <span class="c1">#print(row[&quot;subject_id&quot;], subj_id)</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="n">variant_interpretations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gdc_mutation_service</span><span class="o">.</span><span class="n">fetch_variants</span><span class="p">(</span><span class="n">subj_id</span><span class="p">)</span> <span class="c1"># was rsub_subj[&#39;value&#39;]</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>        <span class="n">vital_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gdc_mutation_service</span><span class="o">.</span><span class="n">fetch_vital_status</span><span class="p">(</span><span class="n">subj_id</span><span class="p">)</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">variant_interpretations</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>            <span class="c1">#print(&quot;No variants found&quot;)</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>            <span class="k">continue</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>        <span class="n">ppackt_d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span><span class="o">.</span><span class="n">subject</span><span class="o">.</span><span class="n">vital_status</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">vital_status</span><span class="p">)</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>        <span class="c1">#else:</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>            <span class="c1">#print(&quot;length variant_interpretations: {}&quot;.format(len(variant_interpretations)))</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="c1"># TODO: improve/enhance diagnosis term annotations</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>        <span class="n">diagnosis</span> <span class="o">=</span> <span class="n">PPkt</span><span class="o">.</span><span class="n">Diagnosis</span><span class="p">()</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>        <span class="n">diagnosis</span><span class="o">.</span><span class="n">disease</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s2">&quot;NCIT:C3262&quot;</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>        <span class="n">diagnosis</span><span class="o">.</span><span class="n">disease</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Neoplasm&quot;</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>        <span class="k">for</span> <span class="n">variant</span> <span class="ow">in</span> <span class="n">variant_interpretations</span><span class="p">:</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>            <span class="n">genomic_interpretation</span> <span class="o">=</span> <span class="n">PPkt</span><span class="o">.</span><span class="n">GenomicInterpretation</span><span class="p">()</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>            <span class="n">genomic_interpretation</span><span class="o">.</span><span class="n">subject_or_biosample_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">]</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>            <span class="n">genomic_interpretation</span><span class="o">.</span><span class="n">interpretation_status</span> <span class="o">=</span> <span class="n">PPkt</span><span class="o">.</span><span class="n">GenomicInterpretation</span><span class="o">.</span><span class="n">InterpretationStatus</span><span class="o">.</span><span class="n">UNKNOWN_STATUS</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>            <span class="n">genomic_interpretation</span><span class="o">.</span><span class="n">variant_interpretation</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">variant</span><span class="p">)</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>            <span class="n">diagnosis</span><span class="o">.</span><span class="n">genomic_interpretations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">genomic_interpretation</span><span class="p">)</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>        <span class="n">interpretation</span> <span class="o">=</span> <span class="n">PPkt</span><span class="o">.</span><span class="n">Interpretation</span><span class="p">()</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>        <span class="n">interpretation</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;researchsubject_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>        <span class="n">interpretation</span><span class="o">.</span><span class="n">progress_status</span> <span class="o">=</span> <span class="n">PPkt</span><span class="o">.</span><span class="n">Interpretation</span><span class="o">.</span><span class="n">ProgressStatus</span><span class="o">.</span><span class="n">IN_PROGRESS</span> 
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>        <span class="n">interpretation</span><span class="o">.</span><span class="n">diagnosis</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">diagnosis</span><span class="p">)</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>        <span class="n">ppackt_d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span><span class="o">.</span><span class="n">interpretations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interpretation</span><span class="p">)</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>    <span class="c1"># TODO Treatment</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>    <span class="c1"># make_cda_medicalaction</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">treatment_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">(),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">treatment_df</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Treatment DF&quot;</span><span class="p">):</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>        <span class="n">individual_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;subject_id&quot;</span><span class="p">]</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="n">medical_action_message</span> <span class="o">=</span> <span class="n">make_cda_medicalaction</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>        <span class="k">if</span> <span class="n">individual_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ppackt_d</span><span class="p">:</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attempt to enter unknown individual ID from treatment factory: </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">individual_id</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>        <span class="n">ppackt_d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">individual_id</span><span class="p">)</span><span class="o">.</span><span class="n">medical_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">medical_action_message</span><span class="p">)</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>    <span class="c1"># When we get here, we have constructed GA4GH Phenopackets with Individual, Disease, Biospecimen, MedicalAction, and GenomicInterpretations</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">ppackt_d</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.oncoexporter.cda.CdaTableImporter.get_merged_diagnosis_research_subject_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_merged_diagnosis_research_subject_df</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">cohort_name</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Retrieve a merged dataframe from CDA corresponding to the diagnosis and research subject tables</p>
<p>diagnosis table columns: diagnosis_id, age_at_diagnosis, grade, method_of_diagnosis, morphology, primary_diagnosis, stage</p>
<p>researchsubject table columns: researchsubject_id, member_of_research_project, primary_diagnosis_condition, primary_diagnosis_site</p>
<p>Need to combine in order to get primary_diagnosis_condition and primary_diagnosis_site with diagnosis table</p>
<p>Original:
diagnosis_callable = lambda: q.diagnosis.run(page_size=self._page_size).get_all().to_dataframe()
diagnosis_df = self._get_cda_df(diagnosis_callable, f"{cohort_name}_diagnosis_df.pkl")
print("obtained diagnosis_df")</p>
<p>rsub_callable = lambda: q.researchsubject.run(page_size=self._page_size).get_all().to_dataframe()
research_subject_df = self._get_cda_df(rsub_callable, f"{cohort_name}_research_subject_df.pkl")
print("obtained research_subject_df")</p>
<p>merged_df = pd.merge(diagnosis_df, research_subject_df, left_on='researchsubject_id', right_on='researchsubject_id',
                     suffixes=["_di", "_rs"])
return merged_df</p>

            <details class="quote">
              <summary>Source code in <code>src/oncoexporter/cda/cda_table_importer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="k">def</span> <span class="nf">get_merged_diagnosis_research_subject_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">cohort_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">    Retrieve a merged dataframe from CDA corresponding to the diagnosis and research subject tables</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">    diagnosis table columns: diagnosis_id, age_at_diagnosis, grade, method_of_diagnosis, morphology, primary_diagnosis, stage</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    researchsubject table columns: researchsubject_id, member_of_research_project, primary_diagnosis_condition, primary_diagnosis_site</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    Need to combine in order to get primary_diagnosis_condition and primary_diagnosis_site with diagnosis table</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">    Original:</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    diagnosis_callable = lambda: q.diagnosis.run(page_size=self._page_size).get_all().to_dataframe()</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    diagnosis_df = self._get_cda_df(diagnosis_callable, f&quot;{cohort_name}_diagnosis_df.pkl&quot;)</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    print(&quot;obtained diagnosis_df&quot;)</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">    rsub_callable = lambda: q.researchsubject.run(page_size=self._page_size).get_all().to_dataframe()</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    research_subject_df = self._get_cda_df(rsub_callable, f&quot;{cohort_name}_research_subject_df.pkl&quot;)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    print(&quot;obtained research_subject_df&quot;)</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">    merged_df = pd.merge(diagnosis_df, research_subject_df, left_on=&#39;researchsubject_id&#39;, right_on=&#39;researchsubject_id&#39;,</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">                         suffixes=[&quot;_di&quot;, &quot;_rs&quot;])</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">    return merged_df</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Getting merged diagnosis and researchsubject df...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="n">diagnosis_callable</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">fetch_rows</span><span class="p">(</span> <span class="n">table</span><span class="o">=</span><span class="s1">&#39;diagnosis&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">q</span> <span class="p">,</span> <span class="n">add_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;subject_id&#39;</span><span class="p">])</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="n">diagnosis_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cda_df</span><span class="p">(</span><span class="n">diagnosis_callable</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cohort_name</span><span class="si">}</span><span class="s2">_diagnosis_df.pkl&quot;</span><span class="p">)</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;obtained diagnosis_df&quot;</span><span class="p">)</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="c1">#diagnosis_df.to_csv(&#39;diagnosis_df.txt&#39;, sep=&#39;\t&#39;)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="c1"># tried link_to_table=&#39;diagnosis&#39; but it doesn&#39;t add any columns</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="n">rsub_callable</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">fetch_rows</span><span class="p">(</span> <span class="n">table</span><span class="o">=</span><span class="s1">&#39;researchsubject&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">q</span> <span class="p">,</span> <span class="n">add_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;subject_id&#39;</span><span class="p">])</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="n">rsub_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cda_df</span><span class="p">(</span><span class="n">rsub_callable</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cohort_name</span><span class="si">}</span><span class="s2">_researchsubject_df.pkl&quot;</span><span class="p">)</span> <span class="c1"># call is repeated below in get_merged_subject_research_subject_df</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;obtained researchsubject_df&quot;</span><span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="c1">#rsub_df.to_csv(&#39;rsub_diagnosis_df.txt&#39;, sep=&#39;\t&#39;)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="c1"># merge tables</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="n">diag_rsub_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">diagnosis_df</span><span class="p">,</span> <span class="n">rsub_df</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;subject_id&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;subject_id&#39;</span><span class="p">)</span> <span class="c1">#, suffixes=[&quot;_di&quot;, &quot;_rs&quot;])</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;obtained merged diagnosis researchsubject df&quot;</span><span class="p">)</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="c1">#diag_rsub_df.to_csv(&#39;diagnosis_rsub.txt&#39;, sep=&#39;\t&#39;)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="k">return</span> <span class="n">diag_rsub_df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.oncoexporter.cda.CdaTableImporter.get_merged_subject_research_subject_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_merged_subject_research_subject_df</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">cohort_name</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Retrieve a merged dataframe from CDA corresponding to the subject and research subject tables
Need both subject_id and researchsubject_id to include variants in phenopacket </p>
<p>subject table columns: subject_id, cause_of_death, days_to_birth, days_to_death, ethnicity, race
                       sex, species, vital_status</p>
<p>researchsubject table columns: researchsubject_id, member_of_research_project, primary_diagnosis_condition, 
                                primary_diagnosis_site</p>
<p>M. Sierk 4-11-24: 
    This is how Henry Schaeffer from CBIIT recommended getting the data source:</p>
<div class="highlight"><pre><span></span><code>I consolidate the data_source_id columns (as opposed to just deleting it which works also) or else 
the merge expands each subject into many more rows. For example, for subject provenance I used:

sub = fetch_rows(table=&#39;subject&#39;, provenance=True)
sub[&#39;subject_data_source_id_concat&#39;] = sub.groupby([&#39;subject_id&#39;,&#39;subject_data_source&#39;])[&#39;subject_data_source_id&#39;].transform(lambda x: &#39;,&#39;.join(x))
sub = sub.drop(columns=[&#39;subject_data_source_id&#39;], axis=1)
sub = sub.drop_duplicates()
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>src/oncoexporter/cda/cda_table_importer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="k">def</span> <span class="nf">get_merged_subject_research_subject_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">cohort_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">    Retrieve a merged dataframe from CDA corresponding to the subject and research subject tables</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">    Need both subject_id and researchsubject_id to include variants in phenopacket </span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">    subject table columns: subject_id, cause_of_death, days_to_birth, days_to_death, ethnicity, race</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">                           sex, species, vital_status</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">    researchsubject table columns: researchsubject_id, member_of_research_project, primary_diagnosis_condition, </span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">                                    primary_diagnosis_site</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">    M. Sierk 4-11-24: </span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">        This is how Henry Schaeffer from CBIIT recommended getting the data source:</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">        I consolidate the data_source_id columns (as opposed to just deleting it which works also) or else </span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">        the merge expands each subject into many more rows. For example, for subject provenance I used:</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">        sub = fetch_rows(table=&#39;subject&#39;, provenance=True)</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">        sub[&#39;subject_data_source_id_concat&#39;] = sub.groupby([&#39;subject_id&#39;,&#39;subject_data_source&#39;])[&#39;subject_data_source_id&#39;].transform(lambda x: &#39;,&#39;.join(x))</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">        sub = sub.drop(columns=[&#39;subject_data_source_id&#39;], axis=1)</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">        sub = sub.drop_duplicates()</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Getting merged subject and researchsubject df...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>    <span class="c1">#subject_callable = lambda: q.subject.run(page_size=self._page_size).get_all().to_dataframe()</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="n">subject_callable</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">fetch_rows</span><span class="p">(</span> <span class="n">table</span><span class="o">=</span><span class="s1">&#39;subject&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">q</span> <span class="p">)</span> <span class="c1"># link_to_table=&#39;researchsubject&#39; doesn&#39;t add anything</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>    <span class="n">subject_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cda_df</span><span class="p">(</span><span class="n">subject_callable</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cohort_name</span><span class="si">}</span><span class="s2">_subject_df.pkl&quot;</span><span class="p">)</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>    <span class="n">rsub_callable</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">fetch_rows</span><span class="p">(</span> <span class="n">table</span><span class="o">=</span><span class="s1">&#39;researchsubject&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">q</span> <span class="p">,</span> <span class="n">add_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;subject_id&#39;</span><span class="p">])</span> <span class="c1"># repeat from above</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="n">rsub_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cda_df</span><span class="p">(</span><span class="n">rsub_callable</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cohort_name</span><span class="si">}</span><span class="s2">_researchsubject_df.pkl&quot;</span><span class="p">)</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="c1"># merge tables</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="n">subject_rsub_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">subject_df</span><span class="p">,</span> <span class="n">rsub_df</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;subject_id&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;subject_id&#39;</span><span class="p">)</span> <span class="c1">#, suffixes=[&quot;_di&quot;, &quot;_rs&quot;])</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;obtained merged subject and researchsubject df&quot;</span><span class="p">)</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="c1">#subject_rsub_df.to_csv(&#39;subject_rsub_df.txt&#39;, sep=&#39;\t&#39;)</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="c1">#rsub_callable = lambda: q.researchsubject.run(page_size=self._page_size).get_all().to_dataframe()</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span class="c1">#rsub_callable = lambda: fetch_rows( table=&#39;researchsubject&#39;, **q , link_to_table=&#39;subject&#39; )</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>    <span class="c1">#research_subject_df = self._get_cda_df(rsub_callable, f&quot;{cohort_name}_research_subject_df.pkl&quot;)</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="c1">#print(&quot;obtained research_subject_df&quot;)</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="c1">#merged_df = pd.merge(subject_df, research_subject_df, left_on=&#39;subject_id&#39;, right_on=&#39;subject_id&#39;,</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>                            <span class="c1">#suffixes=[&quot;_subj&quot;, &quot;_rs&quot;])</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>    <span class="c1">#research_subject_df.to_csv(&#39;researchsubject_df.txt&#39;, sep=&#39;\t&#39;)</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="k">return</span> <span class="n">subject_rsub_df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="src.oncoexporter.cda.CdaTableImporter.get_specimen_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_specimen_df</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">cohort_name</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Retrieve the subject dataframe from CDA</p>
<p>This method uses the Query that was passed to the constructor to retrieve data from the CDA subject table</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>pd.DataFrame</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pandas DataFrame that corresponds to the CDA subject table.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/oncoexporter/cda/cda_table_importer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="k">def</span> <span class="nf">get_specimen_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">cohort_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve the subject dataframe from CDA</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">    This method uses the Query that was passed to the constructor to retrieve data from the CDA subject table</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">    :raises: raises an exception if the query object was not properly initialized</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">    :returns: pandas DataFrame that corresponds to the CDA subject table.</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">    :rtype: pd.DataFrame</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Getting specimen df...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>    <span class="c1">#specimen_callable = lambda: q.specimen.run(page_size=self._page_size).get_all().to_dataframe()</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="n">specimen_callable</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">fetch_rows</span><span class="p">(</span> <span class="n">table</span><span class="o">=</span><span class="s1">&#39;specimen&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">q</span><span class="p">,</span> <span class="n">add_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;subject_id&#39;</span><span class="p">]</span> <span class="p">)</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>    <span class="n">specimen_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cda_df</span><span class="p">(</span><span class="n">specimen_callable</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cohort_name</span><span class="si">}</span><span class="s2">_specimen_df.pkl&quot;</span><span class="p">)</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>    <span class="c1">#specimen_df.to_csv(&#39;specimen_df.txt&#39;, sep=&#39;\t&#39;)</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>    <span class="k">return</span> <span class="n">specimen_df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy", "content.code.select"], "search": "../../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.56dfad97.min.js"></script>
      
    
  </body>
</html>